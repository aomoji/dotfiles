{{- if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "fedora") (eq .chezmoi.osRelease.variant "Silverblue") -}}
#!/bin/bash
set -euo pipefail

if rpm-ostree status | grep -q 'Diff:'; then
  echo "ℹ️  Pending deployment detected. Please run 'systemctl reboot', then run 'chezmoi apply' again."
  exit 0
fi

echo "==> Installing Fedora packages..."

# CLI tools
CLI_PKGS=(
  # For openssl begin
  pkgconf
  perl-FindBin
  perl-IPC-Cmd
  openssl-devel
  # For openssl end
  neovim
  zsh
  lazygit
  direnv
  nkf
  fzf
)

for pkg in "${CLI_PKGS[@]}"; do
  if rpm -q "$pkg" >/dev/null 2>&1; then
    echo "✓ $pkg already installed."
  else
    rpm-ostree install -y "$pkg" || echo "⚠️  Failed to install $pkg"
  fi
done

echo
echo ">>> Please reboot, then run: chezmoi apply <<<"

{{- end -}}
