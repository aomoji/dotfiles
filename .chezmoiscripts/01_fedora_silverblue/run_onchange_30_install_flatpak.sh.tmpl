{{- if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "fedora") (eq .chezmoi.osRelease.variant "Silverblue") -}}
#!/bin/bash
set -euo pipefail

if rpm-ostree status | grep -q 'Diff:'; then
  echo "ℹ️  Pending deployment detected. Please run 'systemctl reboot', then run 'chezmoi apply' again."
  exit 0
fi

# GUI apps（flatpak）
FLATPAK_APPS=(
  org.gnome.Extensions
  org.wezfurlong.wezterm
  com.slack.Slack
  com.spotify.Client
  dev.zed.Zed
)

for app in "${FLATPAK_APPS[@]}"; do
  if flatpak info "$app" >/dev/null 2>&1; then
    echo "✓ $app already installed."
  else
    flatpak install -y flathub "$app" || echo "⚠️  Failed to install $app"
  fi
done

echo "✅ Fedora package install step done."

{{- end -}}
